<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CalmaMente</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .chatbot-container {
            position: fixed;
            bottom: 20px;
            right: 20px;
            display: flex;
            flex-direction: column;
            align-items: flex-end;
            z-index: 1000; /* Garante que o chatbot fique acima de outros elementos */
        }
        .chatbot-button {
            background-color: #000;
            color: #fff;
            border: none;
            padding: 15px;
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            margin-bottom: 10px;
            display: flex;
            justify-content: center;
            align-items: center;
            width: 60px;
            height: 60px;
        }
        .chatbot-button:hover {
            background-color: #222;
        }
        .chatbot-window {
            background-color: #fff;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            width: 300px;
            height: 400px;
            overflow: hidden;
            display: none;
            flex-direction: column;
            justify-content: space-between;
            border: 1px solid #ccc;
        }
        .chatbot-header {
            background-color: #000;
            color: #fff;
            padding: 10px;
            text-align: center;
            border-bottom: 1px solid #ccc;
            position: relative; /* Para posicionar o botão de fechar e limpar */
        }
        .chatbot-messages {
            padding: 10px;
            flex-grow: 1;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        .chatbot-input-area {
            display: flex;
            padding: 10px;
            border-top: 1px solid #ccc;
            align-items: center; /* Alinha verticalmente os itens */
            flex-shrink: 0;
        }
        .chatbot-input {
            flex-grow: 1;
            padding: 8px;
            border: 1px solid #ccc;
            border-radius: 5px;
            margin-right: 10px;
            box-sizing: border-box;
            min-width: 0;
        }
        .chatbot-send-button {
            background-color: #000;
            color: #fff;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            white-space: nowrap;
            flex-shrink: 0;
        }
        .chatbot-send-button:hover {
            background-color: #222;
        }
        .message {
            padding: 10px;
            border-radius: 5px;
            max-width: 80%;
        }
        .user-message {
            background-color: #e0e0e0;
            align-self: flex-end;
        }
        .bot-message {
            background-color: #f0f0f0;
            align-self: flex-start;
        }
        .close-button {
            position: absolute;
            top: 10px;
            right: 10px;
            cursor: pointer;
            font-size: 20px;
            color: #fff;
        }
        .clear-chat-button {
            position: absolute;
            top: 10px;
            left: 10px;
            cursor: pointer;
            font-size: 14px;
            color: #fff;
            background-color: #333;
            padding: 5px 8px;
            border-radius: 5px;
            font-weight: normal;
        }
        .clear-chat-button:hover {
            background-color: #555;
        }
        .loading-dots {
            display: inline-block;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background-color: #000;
            animation: bounce 0.6s infinite alternate;
            margin: 0 2px;
        }

        .loading-dots:nth-child(2) {
            animation-delay: 0.2s;
        }

        .loading-dots:nth-child(3) {
            animation-delay: 0.4s;
        }

        @keyframes bounce {
            0% {
                transform: translateY(0);
            }
            100% {
                transform: translateY(-5px);
            }
        }
    </style>
</head>
<body class="bg-blue-100">
    <header class="bg-blue-600 text-white py-4 text-center rounded-b-md shadow-md">
        <h1 class="text-2xl font-semibold">CalmaMente</h1>
        <p class="text-md">Um espaço de apoio à sua saúde mental.</p>
        <div class="mt-2 flex justify-center">
            <span class="inline-block bg-yellow-400 text-black px-3 py-1 rounded-full text-sm font-semibold">☀️</span>
        </div>
    </header>

    <main class="container mx-auto mt-8 p-4">
        <section class="mb-8 p-6 bg-white rounded-md shadow-md">
            <h2 class="text-xl font-semibold text-blue-700 mb-4">O que é Ansiedade?</h2>
            <p class="text-gray-700">
                A ansiedade é uma reação normal ao estresse, mas pode se tornar um transtorno quando os sentimentos excessivos de medo, preocupação e apreensão interferem nas atividades diárias.  A ansiedade generalizada é caracterizada por preocupação excessiva e persistente sobre diversos aspectos da vida. O transtorno de pânico envolve episódios súbitos de medo intenso, acompanhados de sintomas físicos. Fobias são medos intensos e irracionais de objetos ou situações específicas.
            </p>
            <p class="text-gray-700 mt-4">
                Fonte: <a href="https://www.who.int/news-room/fact-sheets/detail/anxiety-disorders" target="_blank" rel="noopener noreferrer" class="text-blue-500 hover:underline">Organização Mundial da Saúde (OMS)</a>
            </p>
        </section>

        <section class="mb-8 p-6 bg-white rounded-md shadow-md">
            <h2 class="text-xl font-semibold text-blue-700 mb-4">Sintomas da Ansiedade</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                    <h3 class="font-semibold text-gray-800 mb-2">Sintomas Físicos:</h3>
                    <ul class="list-disc list-inside text-gray-700">
                        <li>Palpitações</li>
                        <li>Falta de ar</li>
                        <li>Tensão muscular</li>
                        <li>Sudorese</li>
                        <li>Dor de cabeça</li>
                        <li>Fadiga</li>
                        <li>Problemas gastrointestinais</li>
                    </ul>
                </div>
                <div>
                    <h3 class="font-semibold text-gray-800 mb-2">Sintomas Mentais:</h3>
                    <ul class="list-disc list-inside text-gray-700">
                        <li>Preocupação excessiva</li>
                        <li>Irritabilidade</li>
                        <li>Dificuldade de concentração</li>
                        <li>Medo irracional</li>
                        <li>Sensação de estar "no limite"</li>
                        <li>Dificuldade para relaxar</li>
                        <li>Pensamentos acelerados</li>
                    </ul>
                </div>
            </div>
            <p class="text-gray-700 mt-4">
                Fonte: <a href="https://www.mayoclinic.org/diseases-conditions/generalized-anxiety-disorder/symptoms-causes/syc-20360803" target="_blank" rel="noopener noreferrer" class="text-blue-500 hover:underline">Cleveland Clinic</a>
            </p>
        </section>

        <section class="mb-8 p-6 bg-white rounded-md shadow-md">
            <h2 class="text-xl font-semibold text-blue-700 mb-4">Dicas para Melhorar a Ansiedade</h2>
            <ul class="list-disc list-inside space-y-3 text-gray-700">
                <li><span class="font-semibold">Pratique técnicas de relaxamento:</span> Meditação, respiração diafragmática e yoga podem ajudar a acalmar a mente e o corpo.</li>
                <li><span class="font-semibold">Cuide do seu bem-estar:</span> Durma bem, alimente-se de forma saudável e pratique exercícios físicos regularmente.</li>
                <li><span class="font-semibold">Busque atividades que lhe deem prazer:</span> Hobbies, atividades criativas e momentos de lazer podem reduzir o estresse.</li>
                <li><span class="font-semibold">Evite o consumo excessivo de álcool e cafeína:</span> Essas substâncias podem desencadear ou piorar a ansiedade.</li>
                <li><span class="font-semibold">Converse com alguém de confiança:</span> Compartilhar seus sentimentos pode aliviar a tensão.</li>
                <li><span class="font-semibold">Procure ajuda profissional:</span> Se a ansiedade estiver prejudicando seu dia a dia, um psicólogo ou psiquiatra pode te ajudar.</li>
            </ul>
            <p class="text-gray-700 mt-4">
                Fonte: <a href="https://www.mayoclinic.org/diseases-conditions/anxiety/diagnosis-treatment/drc-20319394" target="_blank" rel="noopener noreferrer" class="text-blue-500 hover:underline">Mayo Clinic</a>
            </p>
        </section>

        <section class="mb-8 p-6 bg-white rounded-md shadow-md">
            <h2 class="text-xl font-semibold text-blue-700 mb-4">Recursos Adicionais</h2>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 text-gray-700">
                <div>
                    <h3 class="font-semibold text-gray-800 mb-2">Canais de Ajuda:</h3>
                    <ul class="list-disc list-inside">
                        <li><a href="https://www.cvv.org.br/" target="_blank" rel="noopener noreferrer" class="text-blue-500 hover:underline">CVV (Centro de Valorização da Vida)</a></li>
                        <li><a href="https://www.saude.gov.br/saude-mental" target="_blank" rel="noopener noreferrer" class="text-blue-500 hover:underline">Ministério da Saúde</a></li>
                    </ul>
                </div>
                <div>
                    <h3 class="font-semibold text-gray-800 mb-2">Livros:</h3>
                    <ul class="list-disc list-inside">
                        <li>"O Corpo Fala", Pierre Weil e Roland Tompakow</li>
                        <li>"Ansiedade: Como Enfrentar o Mal do Século", Augusto Cury</li>
                        <li>"Vencendo a Ansiedade", Dr. Augusto Cury</li>
                    </ul>
                </div>
                <div>
                    <h3 class="font-semibold text-gray-800 mb-2">Aplicativos:</h3>
                    <ul class="list-disc list-inside">
                        <li><a href="https://www.calm.com/" target="_blank" rel="noopener noreferrer" class="text-blue-500 hover:underline">Calm</a></li>
                        <li><a href="https://www.headspace.com/" target="_blank" rel="noopener noreferrer" class="text-blue-500 hover:underline">Headspace</a></li>
                        <li><a href="https://insighttimer.com/" target="_blank" rel="noopener noreferrer" class="text-blue-500 hover:underline">Insight Timer</a></li>
                    </ul>
                </div>
            </div>
        </section>
    </main>

    <footer class="bg-black text-white py-4 text-center rounded-t-md shadow-md">
        <p>© 2024 CalmaMente. Criado por Aline Ometto - Imersão IA Alura. Todos os direitos reservados.</p>
        <p>Este site tem fins informativos e não substitui a avaliação de um profissional de saúde.</p>
    </footer>

    <div class="chatbot-container">
        <button class="chatbot-button" id="chatbot-toggle">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-message-circle-question"><path d="m21.13 2.87-8 8"/><path d="M9.17 15.23a7 7 0 1 0 9.3-9.3"/><path d="M15.5 9.5a1 1 0 1 0 0-2 1 1 0 0 0 0 2"/><path d="M15 13a1 1 0 0 1-1 1 1 1 0 0 1-1-1v-2"/></svg>
        </button>
        <div class="chatbot-window" id="chatbot-window">
            <div class="chatbot-header">
                <span class="close-button" id="close-chatbot">&times;</span>
                <span class="clear-chat-button" id="clear-chat-button">Limpar Chat</span>
                Chatbot CalmaMente
            </div>
            <div class="chatbot-messages" id="chatbot-messages">
                <div class="message bot-message">Olá! Sou o chatbot CalmaMente. Estou aqui para te ajudar com informações e dicas sobre ansiedade. Como você está se sentindo hoje?</div>
            </div>
            <div class="chatbot-input-area">
                <input type="text" id="chatbot-input" class="chatbot-input" placeholder="Digite sua mensagem...">
                <button id="chatbot-send-button" class="chatbot-send-button">Enviar</button>
            </div>
        </div>
    </div>

    <script>
        const chatbotToggle = document.getElementById('chatbot-toggle');
        const chatbotWindow = document.getElementById('chatbot-window');
        const closeChatbot = document.getElementById('close-chatbot');
        const chatbotInput = document.getElementById('chatbot-input');
        const chatbotSendButton = document.getElementById('chatbot-send-button');
        const chatbotMessages = document.getElementById('chatbot-messages');
        const clearChatButton = document.getElementById('clear-chat-button'); // Novo botão

        // Variável para armazenar o histórico do chat
        let chatHistory = [];
        const initialBotMessage = 'Olá! Sou o chatbot CalmaMente. Estou aqui para te ajudar com informações e dicas sobre ansiedade. Como você está se sentindo hoje?';

        // Função para adicionar a mensagem inicial do bot
        function displayInitialBotMessage() {
            chatbotMessages.innerHTML = `<div class="message bot-message">${initialBotMessage}</div>`;
            chatbotMessages.scrollTop = chatbotMessages.scrollHeight;
        }

        // Exibe a mensagem inicial do bot ao carregar a página
        displayInitialBotMessage();

        chatbotToggle.addEventListener('click', () => {
            chatbotWindow.style.display = chatbotWindow.style.display === 'none' ? 'flex' : 'none';
        });

        closeChatbot.addEventListener('click', () => {
            chatbotWindow.style.display = 'none';
        });

        // Event listener para o novo botão "Limpar Chat"
        clearChatButton.addEventListener('click', () => {
            chatHistory = []; // Limpa o histórico
            displayInitialBotMessage(); // Exibe a mensagem inicial do bot novamente
        });

        chatbotSendButton.addEventListener('click', async () => {
            const userMessage = chatbotInput.value.trim();
            if (userMessage === '') return;

            // Adiciona a mensagem do usuário ao histórico da UI
            chatbotMessages.innerHTML += `<div class="message user-message">${userMessage}</div>`;
            // Adiciona a mensagem do usuário ao histórico para a API
            chatHistory.push({ role: "user", parts: [{ text: userMessage }] });
            
            chatbotInput.value = '';
            chatbotMessages.scrollTop = chatbotMessages.scrollHeight;

            // Adiciona um indicador de carregamento
            const loadingMessage = document.createElement('div');
            loadingMessage.classList.add('message', 'bot-message');
            loadingMessage.innerHTML = 'Digitando <span class="loading-dots"></span><span class="loading-dots"></span><span class="loading-dots"></span>';
            chatbotMessages.appendChild(loadingMessage);
            chatbotMessages.scrollTop = chatbotMessages.scrollHeight;

            try {
                const apiKey = ""; // A API Key é fornecida pelo ambiente do Canvas.
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;

                const systemInstruction = 'Você é um assistente pessoal chamado CalmaMente que visa oferecer suporte para lidar com a ansiedade, engajando o usuário para identificar sintomas e contextos, inferir cautelosamente possíveis tipos e gatilhos de ansiedade, fornecer informações relevantes e dicas de relaxamento personalizadas, além de enfatizar a importância da ajuda profissional e orientar sobre como buscá-la, sempre mantendo uma postura empática e evitando diagnósticos. Você sempre utiliza linguagem simples, objetiva e acolhedora. E também, utiliza emoticons para transmitir positividade. O chatbot também é capaz de responder a perguntas relacionadas com o tema ansiedade, por exemplo, o que é ansiedade, quais os sintomas da ansiedade, como saber se estou ansioso (a)?';

                // Prepara o conteúdo a ser enviado para a API, incluindo o histórico
                const contentsToSend = [];
                // Adiciona a instrução do sistema ao primeiro turno da conversa
                contentsToSend.push({ role: "user", parts: [{ text: systemInstruction + "\n" + chatHistory[0].parts[0].text }] });
                // Adiciona o restante do histórico
                for (let i = 1; i < chatHistory.length; i++) {
                    contentsToSend.push(chatHistory[i]);
                }

                const payload = {
                    contents: contentsToSend
                };

                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                const result = await response.json();

                // Remove o indicador de carregamento
                chatbotMessages.removeChild(loadingMessage);

                if (result.candidates && result.candidates.length > 0 &&
                    result.candidates[0].content && result.candidates[0].content.parts &&
                    result.candidates[0].content.parts.length > 0) {
                    const botResponse = result.candidates[0].content.parts[0].text;
                    chatbotMessages.innerHTML += `<div class="message bot-message">${botResponse}</div>`;
                    // Adiciona a resposta do bot ao histórico para a API
                    chatHistory.push({ role: "model", parts: [{ text: botResponse }] });
                } else {
                    chatbotMessages.innerHTML += `<div class="message bot-message">Desculpe, não consegui gerar uma resposta. Por favor, tente novamente.</div>`;
                }
            } catch (error) {
                console.error('Erro ao chamar a API do Gemini:', error);
                // Remove o indicador de carregamento em caso de erro
                chatbotMessages.removeChild(loadingMessage);
                chatbotMessages.innerHTML += `<div class="message bot-message">Ocorreu um erro ao processar sua solicitação. Por favor, tente mais tarde.</div>`;
            }
            chatbotMessages.scrollTop = chatbotMessages.scrollHeight;
        });

        chatbotInput.addEventListener('keydown', (event) => {
            if (event.key === 'Enter') {
                chatbotSendButton.click();
            }
        });
    </script>
</body>
</html>
